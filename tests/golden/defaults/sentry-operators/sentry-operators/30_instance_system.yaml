apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: syn-sentry-cluster
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/enforce: baseline
    pod-security.kubernetes.io/warn: restricted
  name: syn-sentry-cluster
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: grafana-agent
  name: grafana-agent
  namespace: syn-sentry-cluster
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: grafana-agent
  name: grafana-agent
  namespace: syn-sentry-cluster
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: grafana-agent
subjects:
  - kind: ServiceAccount
    name: grafana-agent
    namespace: syn-sentry-cluster
---
apiVersion: monitoring.grafana.com/v1alpha1
kind: GrafanaAgent
metadata:
  labels:
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: cluster
  name: cluster
  namespace: syn-sentry-cluster
spec:
  image: grafana/agent:v0.40.1
  integrations:
    selector:
      matchLabels:
        efk.tegridy.io/integrations: cluster
  logLevel: info
  logs:
    instanceSelector:
      matchLabels:
        efk.tegridy.io/logs: cluster
  metrics:
    instanceSelector:
      matchLabels:
        efk.tegridy.io/metrics: cluster
  serviceAccountName: grafana-agent
